# club-calendar

部活動の集会に関するデータを管理する API と、それを表示するウェブサイトを提供するプロジェクト。


# ディレクトリ構成

- db -- データベースの定義
- lib -- 独立していて、そのまま自由に別プラットフォームへ移植できるライブラリ
- pages -- Next.js のページ
  - api -- HTTP リクエストの API
- public -- デプロイ時にそのまま維持されるファイル
- view -- Next.js のページに使う部品


# ウェブサイト

スケジュールの入ったカレンダーが表示される。

集会の追加ボタンを押すと画面が開き、集会の設定と追加ができる。

スケジュール上の集会をクリックすると画面が開き、集会の設定と中止ができる。


# API

サーバーに以下の HTTP リクエストを送って、集会データを扱える。

ポートは `API_PORT` 環境変数で指定できる。デフォルトは `3080`。

## 使い方

### 取得

`GET /meetings` に以下のクエリを付けてアクセスする。

正常なクエリ引数を渡さないと `400 Bad Request` を返す。

| 引数 | 必須 | 意味                                                   |
| ---- | ---- |
| kind | NO   | 取得する集会の種別で、`Regular` か `Others` にできる。 |
| from | NO   | 日時の文字列で、これ以降の集会を取得する。             |
| to   | NO   | 日時の文字列で、これ以前の集会を取得する。             |

`200 OK` と以下のような JSON を返す。

```json
{
  "meetings": [
    {
      "_id": "hoge",
      "kind": "Others",
      "name": "ホゲ談義",
      "date": "2019-12-12T12:12:00",
      "expired": false
    }
  ]
}
```

### 作成

`POST /meetings` に以下の JSON を付けてアクセスする。

正常な JSON を渡さないと `400 Bad Request` を返す。

```json
{
  "kind": "Others",
  "name": "ホゲ談義",
  "date": "2019-12-12T12:12:00"
}
```

定例会 (`kind` が `Regular`) の場合は、範囲を指定する。
`from` と同じ曜日で、`to` の日付までの予定が複数生成される。

```json
{
  "kind": "Regular",
  "name": "前期定例会",
  "from": "2019-04-09T16:15:00",
  "to": "2019-07-31T16:15:00"
}
```

作成に成功すると、`201 Created` と以下のような JSON を返す。

```json
{
  "ids": [
    "hoge"
  ]
}
```

### 更新

`PATCH /meetings/[id]` に以下の JSON を付けてアクセスする。

JSON には更新したい属性だけを渡す。

正常な JSON を渡さないと `400 Bad Request` を返す。

```json
{
  "name": "ホゲ談義",
  "date": "12:12:00",
  "from": "2019-12-01T00:00:00",
  "to": "2020-01-01T00:00:00",
}
```

更新に成功すると `202 Accpeted` を返す。

### 中止

`PATCH /meetings/[id]/expire` に以下の JSON を付けてアクセスする。

正常な ID でないと `400 Bad Request` を返す。

更新に成功すると、`202 Accepted` を返す。
